!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VUE_NATS=t()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}!function(e,t){if(!e.setImmediate){var n,r,s,i,o,a=1,u={},c=!1,h=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?n=function(e){process.nextTick(function(){f(e)})}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){f(e.data)},n=function(e){s.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(r=h.documentElement,n=function(e){var t=h.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,r.removeChild(t),t=null},r.appendChild(t)}):n=function(e){setTimeout(f,0,e)}:(i="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(i)&&f(+t.data.slice(i.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),n=function(t){e.postMessage(i+t,"*")}),l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var s={callback:e,args:t};return u[a]=s,n(a),a++},l.clearImmediate=p}function p(e){delete u[e]}function f(e){if(c)setTimeout(f,0,e);else{var n=u[e];if(n){c=!0;try{!function(e){var n=e.callback,r=e.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(t,r)}}(n)}finally{p(e),c=!1}}}}}("undefined"==typeof self?e:self);var r=t,s=n;function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===t||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}"function"==typeof global.setTimeout&&(r=setTimeout),"function"==typeof global.clearTimeout&&(s=clearTimeout);var o,a=[],u=!1,c=-1;function h(){u&&o&&(u=!1,o.length?a=o.concat(a):c=-1,a.length&&l())}function l(){if(!u){var e=i(h);u=!0;for(var t=a.length;t;){for(o=a,a=[];++c<t;)o&&o[c].run();c=-1,t=a.length}o=null,u=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===n||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}p.prototype.run=function(){this.fun.apply(null,this.array)};function f(){}var d=f,m=f,v=f,g=f,y=f,b=f,O=f;var w=global.performance||{},E=w.now||w.mozNow||w.msNow||w.oNow||w.webkitNow||function(){return(new Date).getTime()};var S=new Date;var C={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new p(e,t)),1!==a.length||u||i(l)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:d,addListener:m,once:v,off:g,removeListener:y,removeAllListeners:b,emit:O,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*E.call(w),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-S)/1e3}},x="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},_=/%[sdj%]/g;function N(e){if(!G(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(k(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,s=r.length,i=String(e).replace(_,function(e){if("%%"===e)return"%";if(n>=s)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),o=r[n];n<s;o=r[++n])P(o)||!$(o)?i+=" "+o:i+=" "+k(o);return i}function R(e,t){if(H(global.process))return function(){return R(e,t).apply(this,arguments)};var n=!1;return function(){return n||(console.error(t),n=!0),e.apply(this,arguments)}}var T,A={};function j(e){if(H(T)&&(T=C.env.NODE_DEBUG||""),e=e.toUpperCase(),!A[e])if(new RegExp("\\b"+e+"\\b","i").test(T)){A[e]=function(){var t=N.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else A[e]=function(){};return A[e]}function k(e,t){var n={seen:[],stylize:I};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),M(t)?n.showHidden=t:t&&re(n,t),H(n.showHidden)&&(n.showHidden=!1),H(n.depth)&&(n.depth=2),H(n.colors)&&(n.colors=!1),H(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=L),q(n,e,n.depth)}function L(e,t){var n=k.styles[t];return n?"["+k.colors[n][0]+"m"+e+"["+k.colors[n][1]+"m":e}function I(e,t){return e}function q(e,t,n){if(e.customInspect&&t&&K(t.inspect)&&t.inspect!==k&&(!t.constructor||t.constructor.prototype!==t)){var r=t.inspect(n,e);return G(r)||(r=q(e,r,n)),r}var s=function(e,t){if(H(t))return e.stylize("undefined","undefined");if(G(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(J(t))return e.stylize(""+t,"number");if(M(t))return e.stylize(""+t,"boolean");if(P(t))return e.stylize("null","null")}(e,t);if(s)return s;var i=Object.keys(t),o=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(i);if(e.showHidden&&(i=Object.getOwnPropertyNames(t)),V(t)&&(i.indexOf("message")>=0||i.indexOf("description")>=0))return B(t);if(0===i.length){if(K(t)){var a=t.name?": "+t.name:"";return e.stylize("[Function"+a+"]","special")}if(F(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(W(t))return e.stylize(Date.prototype.toString.call(t),"date");if(V(t))return B(t)}var u,c="",h=!1,l=["{","}"];(D(t)&&(h=!0,l=["[","]"]),K(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return F(t)&&(c=" "+RegExp.prototype.toString.call(t)),W(t)&&(c=" "+Date.prototype.toUTCString.call(t)),V(t)&&(c=" "+B(t)),0!==i.length||h&&0!=t.length?n<0?F(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=h?function(e,t,n,r,s){for(var i=[],o=0,a=t.length;o<a;++o)se(t,String(o))?i.push(U(e,t,n,r,String(o),!0)):i.push("");return s.forEach(function(s){s.match(/^\d+$/)||i.push(U(e,t,n,r,s,!0))}),i}(e,t,n,o,i):i.map(function(r){return U(e,t,n,o,r,h)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(u,c,l)):l[0]+c+l[1]}function B(e){return"["+Error.prototype.toString.call(e)+"]"}function U(e,t,n,r,s,i){var o,a,u;if((u=Object.getOwnPropertyDescriptor(t,s)||{value:t[s]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),se(r,s)||(o="["+s+"]"),a||(e.seen.indexOf(u.value)<0?(a=P(n)?q(e,u.value,null):q(e,u.value,n-1)).indexOf("\n")>-1&&(a=i?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),H(o)){if(i&&s.match(/^\d+$/))return a;(o=JSON.stringify(""+s)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function D(e){return Array.isArray(e)}function M(e){return"boolean"==typeof e}function P(e){return null===e}function z(e){return null==e}function J(e){return"number"==typeof e}function G(e){return"string"==typeof e}function Q(e){return"symbol"==typeof e}function H(e){return void 0===e}function F(e){return $(e)&&"[object RegExp]"===X(e)}function $(e){return"object"==typeof e&&null!==e}function W(e){return $(e)&&"[object Date]"===X(e)}function V(e){return $(e)&&("[object Error]"===X(e)||e instanceof Error)}function K(e){return"function"==typeof e}function Y(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function Z(e){return Buffer.isBuffer(e)}function X(e){return Object.prototype.toString.call(e)}function ee(e){return e<10?"0"+e.toString(10):e.toString(10)}k.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},k.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var te=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ne(){var e,t;console.log("%s - %s",(e=new Date,t=[ee(e.getHours()),ee(e.getMinutes()),ee(e.getSeconds())].join(":"),[e.getDate(),te[e.getMonth()],t].join(" ")),N.apply(null,arguments))}function re(e,t){if(!t||!$(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}function se(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ie={inherits:x,_extend:re,log:ne,isBuffer:Z,isPrimitive:Y,isFunction:K,isError:V,isDate:W,isObject:$,isRegExp:F,isUndefined:H,isSymbol:Q,isString:G,isNumber:J,isNullOrUndefined:z,isNull:P,isBoolean:M,isArray:D,inspect:k,deprecate:R,format:N,debuglog:j},oe=Object.freeze({format:N,deprecate:R,debuglog:j,inspect:k,isArray:D,isBoolean:M,isNull:P,isNullOrUndefined:z,isNumber:J,isString:G,isSymbol:Q,isUndefined:H,isRegExp:F,isObject:$,isDate:W,isError:V,isFunction:K,isPrimitive:Y,isBuffer:Z,log:ne,inherits:x,_extend:re,default:ie});function ae(){}function ue(){ue.init.call(this)}function ce(e){return void 0===e._maxListeners?ue.defaultMaxListeners:e._maxListeners}function he(e,t,n,r){var s,i,o,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),o=i[t]):(i=e._events=new ae,e._eventsCount=0),o){if("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(s=ce(e))&&s>0&&o.length>s){o.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=o.length,a=u,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=i[t]=n,++e._eventsCount;return e}function le(e,t,n){var r=!1;function s(){e.removeListener(t,s),r||(r=!0,n.apply(e,arguments))}return s.listener=n,s}function pe(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function fe(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}ae.prototype=Object.create(null),ue.EventEmitter=ue,ue.usingDomains=!1,ue.prototype.domain=void 0,ue.prototype._events=void 0,ue.prototype._maxListeners=void 0,ue.defaultMaxListeners=10,ue.init=function(){this.domain=null,ue.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ae,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ue.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},ue.prototype.getMaxListeners=function(){return ce(this)},ue.prototype.emit=function(e){var t,n,r,s,i,o,a,u="error"===e;if(o=this._events)u=u&&null==o.error;else if(!u)return!1;if(a=this.domain,u){if(t=arguments[1],!a){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(n=o[e]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var r=e.length,s=fe(e,r),i=0;i<r;++i)s[i].call(n)}(n,h,this);break;case 2:!function(e,t,n,r){if(t)e.call(n,r);else for(var s=e.length,i=fe(e,s),o=0;o<s;++o)i[o].call(n,r)}(n,h,this,arguments[1]);break;case 3:!function(e,t,n,r,s){if(t)e.call(n,r,s);else for(var i=e.length,o=fe(e,i),a=0;a<i;++a)o[a].call(n,r,s)}(n,h,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,r,s,i){if(t)e.call(n,r,s,i);else for(var o=e.length,a=fe(e,o),u=0;u<o;++u)a[u].call(n,r,s,i)}(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(r-1),i=1;i<r;i++)s[i-1]=arguments[i];!function(e,t,n,r){if(t)e.apply(n,r);else for(var s=e.length,i=fe(e,s),o=0;o<s;++o)i[o].apply(n,r)}(n,h,this,s)}return!0},ue.prototype.addListener=function(e,t){return he(this,e,t,!1)},ue.prototype.on=ue.prototype.addListener,ue.prototype.prependListener=function(e,t){return he(this,e,t,!0)},ue.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,le(this,e,t)),this},ue.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,le(this,e,t)),this},ue.prototype.removeListener=function(e,t){var n,r,s,i,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new ae:(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(s=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){o=n[i].listener,s=i;break}if(s<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new ae,this;delete r[e]}else!function(e,t){for(var n=t,r=n+1,s=e.length;r<s;n+=1,r+=1)e[n]=e[r];e.pop()}(n,s);r.removeListener&&this.emit("removeListener",e,o||t)}return this},ue.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new ae,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new ae:delete n[e]),this;if(0===arguments.length){for(var r,s=Object.keys(n),i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new ae,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},ue.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},ue.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):pe.call(e,t)},ue.prototype.listenerCount=pe,ue.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var de=Object.freeze({default:ue,EventEmitter:ue}),me=oe&&ie||oe,ve=de&&ue||de;let ge=ve.EventEmitter;function ye(e){let t=this;ge.call(this),this.sock=new WebSocket(e),this.sock.addEventListener("open",function(){t.emit("connect")}),this.sock.addEventListener("message",function(e){t.emit("data",new Buffer(e.data))}),this.sock.addEventListener("error",function(e){t.emit("error",e)}),this.sock.addEventListener("close",function(){t.emit("close")})}me.inherits(ye,ge),ye.prototype.end=function(){this.destroy()},ye.prototype.destroy=function(){this.sock.readyState!==WebSocket.CONNECTING&&this.sock.readyState!==WebSocket.OPEN||this.sock.close()},ye.prototype.write=function(e){this.sock.readyState===WebSocket.OPEN&&this.sock.send(e)},ye.prototype.pause=function(){console.warn("WebSocketProxy stream pause/resume is not supported yet.")},ye.prototype.resume=function(){};var be=function(e){return new ye(e.format({protocol:e.protocol,slashes:e.slashes,host:e.host,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search,path:e.path,query:e.query,hash:e.hash}))},Oe=function(e,t){throw"TLS is not supported in the browser. Use WSS instead."},we=2147483647,Ee=36,Se=1,Ce=26,xe=38,_e=700,Ne=72,Re=128,Te="-",Ae=/[^\x20-\x7E]/,je=/[\x2E\u3002\uFF0E\uFF61]/g,ke={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Le=Ee-Se,Ie=Math.floor,qe=String.fromCharCode;function Be(e){throw new RangeError(ke[e])}function Ue(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function De(e,t,n){var r=0;for(e=n?Ie(e/_e):e>>1,e+=Ie(e/t);e>Le*Ce>>1;r+=Ee)e=Ie(e/Le);return Ie(r+(Le+1)*e/(e+xe))}function Me(e){return function(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]);var s=function(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}((e=e.replace(je,".")).split("."),t).join(".");return r+s}(e,function(e){return Ae.test(e)?"xn--"+function(e){var t,n,r,s,i,o,a,u,c,h,l,p,f,d,m,v=[];for(p=(e=function(e){for(var t,n,r=[],s=0,i=e.length;s<i;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<i?56320==(64512&(n=e.charCodeAt(s++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),s--):r.push(t);return r}(e)).length,t=Re,n=0,i=Ne,o=0;o<p;++o)(l=e[o])<128&&v.push(qe(l));for(r=s=v.length,s&&v.push(Te);r<p;){for(a=we,o=0;o<p;++o)(l=e[o])>=t&&l<a&&(a=l);for(a-t>Ie((we-n)/(f=r+1))&&Be("overflow"),n+=(a-t)*f,t=a,o=0;o<p;++o)if((l=e[o])<t&&++n>we&&Be("overflow"),l==t){for(u=n,c=Ee;!(u<(h=c<=i?Se:c>=i+Ce?Ce:c-i));c+=Ee)m=u-h,d=Ee-h,v.push(qe(Ue(h+m%d,0))),u=Ie(m/d);v.push(qe(Ue(u,0))),i=De(n,f,r==s),n=0,++r}++n,++t}return v.join("")}(e):e})}function Pe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var ze=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function Je(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function Ge(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var Qe=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t};function He(e,t,n,r){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var i=/\+/g;e=e.split(t);var o=1e3;r&&"number"==typeof r.maxKeys&&(o=r.maxKeys);var a=e.length;o>0&&a>o&&(a=o);for(var u=0;u<a;++u){var c,h,l,p,f=e[u].replace(i,"%20"),d=f.indexOf(n);d>=0?(c=f.substr(0,d),h=f.substr(d+1)):(c=f,h=""),l=decodeURIComponent(c),p=decodeURIComponent(h),Pe(s,l)?ze(s[l])?s[l].push(p):s[l]=[s[l],p]:s[l]=p}return s}var Fe={parse:at,resolve:lt,resolveObject:pt,format:ct,Url:$e};function $e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var We=/^([a-z0-9.+-]+:)/i,Ve=/:[0-9]*$/,Ke=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Ye=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ze=["'"].concat(Ye),Xe=["%","/","?",";","#"].concat(Ze),et=["/","?","#"],tt=255,nt=/^[+a-z0-9A-Z_-]{0,63}$/,rt=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,st={javascript:!0,"javascript:":!0},it={javascript:!0,"javascript:":!0},ot={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function at(e,t,n){if(e&&$(e)&&e instanceof $e)return e;var r=new $e;return r.parse(e,t,n),r}function ut(e,t,n,r){if(!G(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var s=t.indexOf("?"),i=-1!==s&&s<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var a=t=o.join(i);if(a=a.trim(),!r&&1===t.split("#").length){var u=Ke.exec(a);if(u)return e.path=a,e.href=a,e.pathname=u[1],u[2]?(e.search=u[2],e.query=n?He(e.search.substr(1)):e.search.substr(1)):n&&(e.search="",e.query={}),e}var c,h,l,p,f=We.exec(a);if(f){var d=(f=f[0]).toLowerCase();e.protocol=d,a=a.substr(f.length)}if(r||f||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var m="//"===a.substr(0,2);!m||f&&it[f]||(a=a.substr(2),e.slashes=!0)}if(!it[f]&&(m||f&&!ot[f])){var v,g,y=-1;for(c=0;c<et.length;c++)-1!==(h=a.indexOf(et[c]))&&(-1===y||h<y)&&(y=h);for(-1!==(g=-1===y?a.lastIndexOf("@"):a.lastIndexOf("@",y))&&(v=a.slice(0,g),a=a.slice(g+1),e.auth=decodeURIComponent(v)),y=-1,c=0;c<Xe.length;c++)-1!==(h=a.indexOf(Xe[c]))&&(-1===y||h<y)&&(y=h);-1===y&&(y=a.length),e.host=a.slice(0,y),a=a.slice(y),ft(e),e.hostname=e.hostname||"";var b="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!b){var O=e.hostname.split(/\./);for(c=0,l=O.length;c<l;c++){var w=O[c];if(w&&!w.match(nt)){for(var E="",S=0,C=w.length;S<C;S++)w.charCodeAt(S)>127?E+="x":E+=w[S];if(!E.match(nt)){var x=O.slice(0,c),_=O.slice(c+1),N=w.match(rt);N&&(x.push(N[1]),_.unshift(N[2])),_.length&&(a="/"+_.join(".")+a),e.hostname=x.join(".");break}}}}e.hostname.length>tt?e.hostname="":e.hostname=e.hostname.toLowerCase(),b||(e.hostname=Me(e.hostname)),p=e.port?":"+e.port:"";var R=e.hostname||"";e.host=R+p,e.href+=e.host,b&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!st[d])for(c=0,l=Ze.length;c<l;c++){var T=Ze[c];if(-1!==a.indexOf(T)){var A=encodeURIComponent(T);A===T&&(A=escape(T)),a=a.split(T).join(A)}}var j=a.indexOf("#");-1!==j&&(e.hash=a.substr(j),a=a.slice(0,j));var k=a.indexOf("?");if(-1!==k?(e.search=a.substr(k),e.query=a.substr(k+1),n&&(e.query=He(e.query)),a=a.slice(0,k)):n&&(e.search="",e.query={}),a&&(e.pathname=a),ot[d]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){p=e.pathname||"";var L=e.search||"";e.path=p+L}return e.href=ht(e),e}function ct(e){return G(e)&&(e=ut({},e)),ht(e)}function ht(e){var t=e.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var n,r,s,i,o=e.protocol||"",a=e.pathname||"",u=e.hash||"",c=!1,h="";e.host?c=t+e.host:e.hostname&&(c=t+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(c+=":"+e.port)),e.query&&$(e.query)&&Object.keys(e.query).length&&(n=e.query,r=r||"&",s=s||"=",null===n&&(n=void 0),h="object"==typeof n?Ge(Qe(n),function(e){var t=encodeURIComponent(Je(e))+s;return ze(n[e])?Ge(n[e],function(e){return t+encodeURIComponent(Je(e))}).join(r):t+encodeURIComponent(Je(n[e]))}).join(r):i?encodeURIComponent(Je(i))+s+encodeURIComponent(Je(n)):"");var l=e.search||h&&"?"+h||"";return o&&":"!==o.substr(-1)&&(o+=":"),e.slashes||(!o||ot[o])&&!1!==c?(c="//"+(c||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):c||(c=""),u&&"#"!==u.charAt(0)&&(u="#"+u),l&&"?"!==l.charAt(0)&&(l="?"+l),o+c+(a=a.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(l=l.replace("#","%23"))+u}function lt(e,t){return at(e,!1,!0).resolve(t)}function pt(e,t){return e?at(e,!1,!0).resolveObject(t):t}function ft(e){var t=e.host,n=Ve.exec(t);n&&(":"!==(n=n[0])&&(e.port=n.substr(1)),t=t.substr(0,t.length-n.length)),t&&(e.hostname=t)}$e.prototype.parse=function(e,t,n){return ut(this,e,t,n)},$e.prototype.format=function(){return ht(this)},$e.prototype.resolve=function(e){return this.resolveObject(at(e,!1,!0)).format()},$e.prototype.resolveObject=function(e){if(G(e)){var t=new $e;t.parse(e,!1,!0),e=t}for(var n,r=new $e,s=Object.keys(this),i=0;i<s.length;i++){var o=s[i];r[o]=this[o]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),u=0;u<a.length;u++){var c=a[u];"protocol"!==c&&(r[c]=e[c])}return ot[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!ot[e.protocol]){for(var h=Object.keys(e),l=0;l<h.length;l++){var p=h[l];r[p]=e[p]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||it[e.protocol])r.pathname=e.pathname;else{for(n=(e.pathname||"").split("/");n.length&&!(e.host=n.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==n[0]&&n.unshift(""),n.length<2&&n.unshift(""),r.pathname=n.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",d=r.search||"";r.path=f+d}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m,v=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=g||v||r.host&&e.pathname,b=y,O=r.pathname&&r.pathname.split("/")||[],w=r.protocol&&!ot[r.protocol];if(n=e.pathname&&e.pathname.split("/")||[],w&&(r.hostname="",r.port=null,r.host&&(""===O[0]?O[0]=r.host:O.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===n[0]?n[0]=e.host:n.unshift(e.host)),e.host=null),y=y&&(""===n[0]||""===O[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,O=n;else if(n.length)O||(O=[]),O.pop(),O=O.concat(n),r.search=e.search,r.query=e.query;else if(!z(e.search))return w&&(r.hostname=r.host=O.shift(),(m=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=m.shift(),r.host=r.hostname=m.shift())),r.search=e.search,r.query=e.query,P(r.pathname)&&P(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!O.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var E=O.slice(-1)[0],S=(r.host||e.host||O.length>1)&&("."===E||".."===E)||""===E,C=0,x=O.length;x>=0;x--)"."===(E=O[x])?O.splice(x,1):".."===E?(O.splice(x,1),C++):C&&(O.splice(x,1),C--);if(!y&&!b)for(;C--;C)O.unshift("..");!y||""===O[0]||O[0]&&"/"===O[0].charAt(0)||O.unshift(""),S&&"/"!==O.join("/").substr(-1)&&O.push("");var _=""===O[0]||O[0]&&"/"===O[0].charAt(0);return w&&(r.hostname=r.host=_?"":O.length?O.shift():"",(m=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=m.shift(),r.host=r.hostname=m.shift())),(y=y||r.host&&O.length)&&!_&&O.unshift(""),O.length?r.pathname=O.join("/"):(r.pathname=null,r.path=null),P(r.pathname)&&P(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},$e.prototype.parseHost=function(){return ft(this)};var dt=Object.freeze({parse:at,resolve:lt,resolveObject:pt,format:ct,default:Fe,Url:$e}),mt=window.crypto||window.msCrypto,vt=function(e,t){var n=new Uint8Array(e);return e>0&&mt.getRandomValues(n),n},gt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",yt=22;function bt(){this.buf=Buffer.alloc(yt),this.init()}bt.prototype.init=function(){this.setPre(),this.initSeqAndInc(),this.fillSeq()},bt.prototype.initSeqAndInc=function(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)},bt.prototype.setPre=function(){for(var e=vt(12),t=0;t<12;t++){var n=e[t]%36;this.buf[t]=gt.charCodeAt(n)}},bt.prototype.fillSeq=function(){for(var e=this.seq,t=yt-1;t>=12;t--)this.buf[t]=gt.charCodeAt(e%36),e=Math.floor(e/36)},bt.prototype.next=function(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),this.buf.toString("ascii")};var Ot,wt=new bt,Et=function(){return wt.next()},St=dt&&Fe||dt,Ct=(function(e,t){var n=/^MSG\s+([^\s\r\n]+)\s+([^\s\r\n]+)\s+(([^\s\r\n]+)[^\S\r\n]+)?(\d+)\r\n/i,r=/^\+OK\s*\r\n/i,s=/^-ERR\s+('.+')?\r\n/i,i=/^PING\r\n/i,o=/^PONG\r\n/i,a=/^INFO\s+([^\r\n]+)\r\n/i,u=/^SUB\s+([^\r\n]+)\r\n/i,c="\r\n",h=c.length;function l(e,t,n){Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.message=e,this.code=t,this.chainedError=n}me.inherits(l,Error),t.NatsError=l,t.version="0.8.8",t.BAD_SUBJECT="BAD_SUBJECT",t.BAD_MSG="BAD_MSG",t.BAD_REPLY="BAD_REPLY",t.CONN_CLOSED="CONN_CLOSED",t.BAD_JSON="BAD_JSON",t.BAD_AUTHENTICATION="BAD_AUTHENTICATION",t.INVALID_ENCODING="INVALID_ENCODING",t.SECURE_CONN_REQ="SECURE_CONN_REQ",t.NON_SECURE_CONN_REQ="NON_SECURE_CONN_REQ",t.CLIENT_CERT_REQ="CLIENT_CERT_REQ",t.NATS_PROTOCOL_ERR="NATS_PROTOCOL_ERR",t.REQ_TIMEOUT="REQ_TIMEOUT";var p=t.createInbox=function(){return"_INBOX."+Et()};function f(e){ve.EventEmitter.call(this),this.parseOptions(e),this.initState(),this.createConnection()}function d(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e}function m(e){this.url=e,this.didConnect=!1,this.reconnects=0}t.connect=function(e){return new f(e)},me.inherits(f,ve.EventEmitter),f.prototype.createInbox=p,f.prototype.assignOption=function(e,t,n){void 0===n&&(n=t),void 0!==e[t]&&(this.options[n]=e[t])},f.prototype.parseOptions=function(e){var t=this.options={verbose:!1,pedantic:!1,reconnect:!0,maxReconnectAttempts:10,reconnectTimeWait:2e3,encoding:"utf8",tls:!1,waitOnFirstConnect:!1,pingInterval:12e4,maxPingOut:2,useOldRequestStyle:!1};void 0===e?t.url="nats://localhost:4222":"number"==typeof e?t.url="nats://localhost:"+e:"string"==typeof e?t.url=e:"object"==typeof e&&(void 0!==e.port&&(t.url="nats://localhost:"+e.port),this.assignOption(e,"url"),this.assignOption(e,"uri","url"),this.assignOption(e,"user"),this.assignOption(e,"pass"),this.assignOption(e,"token"),this.assignOption(e,"password","pass"),this.assignOption(e,"verbose"),this.assignOption(e,"pedantic"),this.assignOption(e,"reconnect"),this.assignOption(e,"maxReconnectAttempts"),this.assignOption(e,"reconnectTimeWait"),this.assignOption(e,"servers"),this.assignOption(e,"urls","servers"),this.assignOption(e,"noRandomize"),this.assignOption(e,"NoRandomize","noRandomize"),this.assignOption(e,"dontRandomize","noRandomize"),this.assignOption(e,"encoding"),this.assignOption(e,"tls"),this.assignOption(e,"secure","tls"),this.assignOption(e,"name"),this.assignOption(e,"client","name"),this.assignOption(e,"yieldTime"),this.assignOption(e,"waitOnFirstConnect"),this.assignOption(e,"json"),this.assignOption(e,"preserveBuffers"),this.assignOption(e,"pingInterval"),this.assignOption(e,"maxPingOut"),this.assignOption(e,"useOldRequestStyle"));var n=this;if(n.user=t.user,n.pass=t.pass,n.token=t.token,n.user&&n.token)throw new l("User and Token can not both be provided","BAD_AUTHENTICATION");if(!Buffer.isEncoding(t.encoding))throw new l("Invalid Encoding:"+t.encoding,"INVALID_ENCODING");n.encoding=t.encoding,n.servers=[],Array.isArray(t.servers)?(t.servers.forEach(function(e){n.servers.push(new m(St.parse(e)))}),!0!==t.noRandomize&&d(n.servers),void 0!==t.url&&-1===n.servers.indexOf(t.url)&&n.servers.unshift(new m(St.parse(t.url)))):(void 0===t.url&&(t.url="nats://localhost:4222"),n.servers.push(new m(St.parse(t.url))))},m.prototype.toString=function(){return this.url.href},f.prototype.selectServer=function(){var e=this.servers.shift();if(this.currentServer=e,this.url=e.url,"auth"in e.url&&e.url.auth){var t=e.url.auth.split(":");1!==t.length?(void 0===this.options.user&&(this.user=t[0]),void 0===this.options.pass&&(this.pass=t[1])):void 0===this.options.token&&(this.token=t[0])}this.servers.push(e)},f.prototype.checkTLSMismatch=function(){return!0===this.info.tls_required&&!1===this.options.tls?(this.emit("error",new l("Server requires a secure connection.","SECURE_CONN_REQ")),this.closeStream(),!0):!1===this.info.tls_required&&!1!==this.options.tls?(this.emit("error",new l("Server does not support a secure connection.","NON_SECURE_CONN_REQ")),this.closeStream(),!0):!0===this.info.tls_verify&&void 0===this.options.tls.cert&&(this.emit("error",new l("Server requires a client certificate.","CLIENT_CERT_REQ")),this.closeStream(),!0)},f.prototype.connectCB=function(){var e=!0===this.reconnecting?"reconnect":"connect";this.reconnecting=!1,this.reconnects=0,this.wasConnected=!0,this.currentServer.didConnect=!0,this.emit(e,this),this.flushPending()},f.prototype.scheduleHeartbeat=function(){this.pingTimer=setTimeout(function(e){if(e.emit("pingtimer"),!e.closed){if(e.stream&&!e.stream.connecting){if(e.emit("pingcount",e.pout),e.pout++,e.pout>e.options.maxPingOut)return void e.processErr("stale connection");e.sendCommand("PING\r\n"),e.pongs&&e.pongs.push(void 0)}e.scheduleHeartbeat()}},this.options.pingInterval,this)},f.prototype.setupHandlers=function(){var e=this,t=e.stream;void 0!==t&&(t.on("connect",function(){e.pingTimer&&(clearTimeout(e.pingTimer),delete e.pingTimer),e.connected=!0,e.scheduleHeartbeat()}),t.on("close",function(t){e.closeStream(),e.emit("disconnect"),!0===e.closed||!1===e.options.reconnect||e.reconnects>=e.options.maxReconnectAttempts&&-1!==e.options.maxReconnectAttempts?e.emit("close"):e.scheduleReconnect()}),t.on("error",function(t){!0===e.wasConnected&&!0===e.currentServer.didConnect||(!1===e.wasConnected&&!1===e.currentServer.didConnect&&(e.options.waitOnFirstConnect?e.currentServer.didConnect=!0:e.servers.splice(e.servers.length-1,1)),!1===e.wasConnected&&0===e.servers.length&&e.emit("error",new l("Could not connect to server: "+t,"CONN_ERR",t)),e.closeStream())}),t.on("data",function(t){e.inbound?e.inbound=Buffer.concat([e.inbound,t]):e.inbound=t,e.processInbound()}))},f.prototype.sendConnect=function(){var e={lang:"node",version:"0.8.8",verbose:this.options.verbose,pedantic:this.options.pedantic,protocol:1};void 0!==this.user&&(e.user=this.user,e.pass=this.pass),void 0!==this.token&&(e.auth_token=this.token),void 0!==this.options.name&&(e.name=this.options.name),this.stream.write("CONNECT "+JSON.stringify(e)+c)},f.prototype.createConnection=function(){var e=[],t=[],n=0,r=this;if(null!==r.pending){var s=0;r.pending.forEach(function(i){var o=Buffer.isBuffer(i)?i.length:Buffer.byteLength(i);if("PING\r\n"===i&&null!==r.pongs&&s<r.pongs.length){var a=r.pongs[s++];void 0!==a&&(t.push(i),n+=o,e.push(a))}else i.length>3&&"P"===i[0]&&"U"===i[1]&&"B"===i[2]&&(t.push(i),n+=o)})}this.pongs=e,this.pending=t,this.pSize=n,this.pstate=0,this.info=null,this.infoReceived=!1,this.selectServer(),this.stream&&(this.stream.removeAllListeners(),this.stream.end()),this.stream=be(this.url),this.setupHandlers()},f.prototype.initState=function(){this.ssid=1,this.subs={},this.reconnects=0,this.connected=!1,this.wasConnected=!1,this.reconnecting=!1,this.server=null,this.pending=[],this.pout=0},f.prototype.close=function(){this.pingTimer&&(clearTimeout(this.pingTimer),delete this.pingTimer),this.closed=!0,this.removeAllListeners(),this.closeStream(),this.ssid=-1,this.subs=null,this.pstate=-1,this.pongs=null,this.pending=null,this.pSize=0},f.prototype.closeStream=function(){null!==this.stream&&(this.stream.end(),this.stream.destroy(),this.stream=null),!0!==this.connected&&!0!==this.closed||(this.pongs=null,this.pout=0,this.pending=null,this.pSize=0,this.connected=!1),this.inbound=null},f.prototype.flushPending=function(){if(!1!==this.connected&&null!==this.pending&&0!==this.pending.length&&!0===this.infoReceived){var e=this,t=function(t){return e.pending=[],e.pSize=0,e.stream.write(t)};if(this.pBufs){for(var n=!0,r=0;r<this.pending.length;r++)if(!Buffer.isBuffer(this.pending[r])){n=!1;break}if(n)return t(Buffer.concat(this.pending,this.pSize));var s=this.pending;this.pending=[],this.pSize=0;var i=!0;for(r=0;r<s.length;r++)i=this.stream.write(s[r])&&i;return i}return t(this.pending.join(""))}},f.prototype.stripPendingSubs=function(){var e=this.pending;this.pending=[],this.pSize=0;for(var t=0;t<e.length;t++)u.test(e[t])||this.sendCommand(e[t])},f.prototype.sendCommand=function(e){if(!this.closed&&null!==this.pending&&(this.pending.push(e),Buffer.isBuffer(e)?(this.pSize+=e.length,this.pBufs=!0):this.pSize+=Buffer.byteLength(e),!0===this.connected))if(1===this.pending.length){var t=this;setImmediate(function(){t.flushPending()})}else this.pSize>65536&&this.flushPending()},f.prototype.sendSubscriptions=function(){var e="";for(var t in this.subs)if(this.subs.hasOwnProperty(t)){var n=this.subs[t];e+=(n.qgroup?["SUB",n.subject,n.qgroup,t+c]:["SUB",n.subject,t+c]).join(" ")}e.length>0&&this.stream.write(e)},f.prototype.processInbound=function(){var e,t,u=this;if(u.stream)for(u.stream.resume(),void 0!==u.options.yieldTime&&(t=Date.now());!u.closed&&u.inbound&&u.inbound.length>0;){switch(u.pstate){case 0:var c=u.inbound.toString("binary",0,1024);if(null!==(e=n.exec(c)))u.payload={subj:e[1],sid:parseInt(e[2],10),reply:e[4],size:parseInt(e[5],10)},u.payload.psize=u.payload.size+h,u.pstate=1;else if(null!==(e=r.exec(c)));else{if(null!==(e=s.exec(c)))return void u.processErr(e[1]);if(null!==(e=o.exec(c))){u.pout=0;var l=u.pongs&&u.pongs.shift();l&&l()}else if(null!==(e=i.exec(c)))u.sendCommand("PONG\r\n");else{if(null===(e=a.exec(c)))return;if(u.info=JSON.parse(e[1]),!0===u.checkTLSMismatch())return;if(u.processServerUpdate(),!1===u.infoReceived){if(!1!==u.options.tls&&!0!==u.stream.encrypted){var p={socket:u.stream};if("object"==typeof u.options.tls)for(var f in u.options.tls)p[f]=u.options.tls[f];u.stream&&(u.stream.removeAllListeners(),u.stream.end()),u.stream=Oe(p,function(){u.flushPending()}),u.setupHandlers()}u.sendConnect(),u.sendSubscriptions(),u.pongs.unshift(function(){u.connectCB()}),u.stream.write("PING\r\n"),u.infoReceived=!0,u.stripPendingSubs(),u.flushPending()}}}break;case 1:if(u.inbound.length<u.payload.psize)return void 0===u.payload.chunks&&(u.payload.chunks=[]),u.payload.chunks.push(u.inbound),u.payload.psize-=u.inbound.length,void(u.inbound=null);if(u.payload.chunks){u.payload.chunks.push(u.inbound.slice(0,u.payload.psize));var d=Buffer.concat(u.payload.chunks,u.payload.size);u.options.preserveBuffers?u.payload.msg=d:u.payload.msg=d.toString(u.encoding)}else u.options.preserveBuffers?u.payload.msg=u.inbound.slice(0,u.payload.size):u.payload.msg=u.inbound.toString(u.encoding,0,u.payload.size);if(u.inbound.length===u.payload.psize?u.inbound=null:u.inbound=u.inbound.slice(u.payload.psize),u.processMsg(),u.pstate=0,u.payload=null,void 0!==t&&Date.now()-t>u.options.yieldTime)return u.stream.pause(),void setImmediate(u.processInbound.bind(this))}if(e&&!this.closed){var m=e[0].length;m>=u.inbound.length?u.inbound=null:u.inbound=u.inbound.slice(m)}e=null}},f.prototype.processServerUpdate=function(){var e=this;if(e.info.connect_urls&&e.info.connect_urls.length>0){var t={};e.info.connect_urls.forEach(function(e){var n="nats://"+e,r=new m(St.parse(n));r.implicit=!0,t[r.url.href]=r});var n=[];e.servers.forEach(function(r,s){var i=r.url.href;r.implicit&&e.currentServer.url.href!==i&&void 0===t[i]&&n.push(s),delete t[i]}),n.reverse(),n.forEach(function(t){e.servers.splice(t,1)});var r=[];for(var s in t)t.hasOwnProperty(s)&&(e.servers.push(t[s]),r.push(s));r.length&&e.emit("serversDiscovered",r)}},f.prototype.processMsg=function(){var e=this.subs[this.payload.sid];if(void 0!==e&&(e.received+=1,e.timeout&&e.received>=e.expected&&(clearTimeout(e.timeout),e.timeout=null),void 0!==e.max&&(e.received===e.max?(delete this.subs[this.payload.sid],this.emit("unsubscribe",this.payload.sid,e.subject)):e.received>e.max&&(this.unsubscribe(this.payload.sid),e.callback=null)),e.callback)){var t=this.payload.msg;if(this.options.json)try{t=this.options.preserveBuffers?JSON.parse(this.payload.msg.toString()):JSON.parse(this.payload.msg.toString(this.options.encoding))}catch(e){t=e}e.callback(t,this.payload.reply,this.payload.subj,this.payload.sid)}},f.prototype.processErr=function(e){var t=e?e.toLowerCase():"";-1!==t.indexOf("stale connection")?this.closeStream():-1!==t.indexOf("permissions violation")?this.emit("permission_error",new l(e,"NATS_PROTOCOL_ERR")):(this.emit("error",new l(e,"NATS_PROTOCOL_ERR")),this.closeStream())},f.prototype.addServer=function(e){this.servers.push(new m(St.parse(e))),!0!==this.options.noRandomize&&d(this.servers)},f.prototype.flush=function(e){if(this.closed){if("function"==typeof e)return void e(new l("Connection closed","CONN_CLOSED"));throw new l("Connection closed","CONN_CLOSED")}this.pongs&&(this.pongs.push(e),this.sendCommand("PING\r\n"),this.flushPending())},f.prototype.publish=function(e,t,n,r){if("function"==typeof e&&(r=e,e=void 0),t=this.options.json?void 0===t?null:t:t||"",!e){if(!r)throw new l("Subject must be supplied","BAD_SUBJECT");r(new l("Subject must be supplied","BAD_SUBJECT"))}if("function"==typeof t){if(r||n)return void r(new l("Message can't be a function","BAD_MSG"));r=t,t="",n=void 0}if("function"==typeof n){if(r)return void r(new l("Reply can't be a function","BAD_REPLY"));r=n,n=void 0}var s;if(s=void 0===n?"PUB "+e+" ":"PUB "+e+" "+n+" ",Buffer.isBuffer(t)){var i=new Buffer(s.length+t.length+2*h+t.length.toString().length),o=i.write(s+t.length+c);t.copy(i,o),i.write(c,o+t.length),this.sendCommand(i)}else{var a=t;if(this.options.json)try{a=JSON.stringify(t)}catch(e){throw new l("Message should be a JSON object","BAD_JSON")}this.sendCommand(s+Buffer.byteLength(a)+c+a+c)}if(void 0!==r)this.flush(r);else if(this.closed)throw new l("Connection closed","CONN_CLOSED")},f.prototype.subscribe=function(e,t,n){if(this.closed)throw new l("Connection closed","CONN_CLOSED");var r,s,i;return"function"==typeof t?(n=t,t=void 0):t&&"object"==typeof t&&(r=t.queue,s=t.max),this.ssid+=1,this.subs[this.ssid]={subject:e,callback:n,received:0},"string"==typeof r?(this.subs[this.ssid].qgroup=r,i=["SUB",e,r,this.ssid+c]):i=["SUB",e,this.ssid+c],this.sendCommand(i.join(" ")),this.emit("subscribe",this.ssid,e,t),s&&this.unsubscribe(this.ssid,s),this.ssid},f.prototype.unsubscribe=function(e,t){if(e&&!this.closed)if(e<0)this.cancelMuxRequest(e);else{var n;n=t?["UNSUB",e,t+c]:["UNSUB",e+c],this.sendCommand(n.join(" "));var r=this.subs[e];void 0!==r&&(r.max=t,(void 0===r.max||r.received>=r.max)&&(r.timeout&&(clearTimeout(r.timeout),r.timeout=null),delete this.subs[e],this.emit("unsubscribe",e,r.subject)))}},f.prototype.timeout=function(e,t,n,r){if(e){var s=null;if(e<0){var i=this.getMuxRequestConfig(e);i&&i.timeout&&clearTimeout(i.timeout),s=i}else s=this.subs[e];if(s){s.expected=n;var o=this;s.timeout=setTimeout(function(){r(e),o.unsubscribe(e)},t)}}},f.prototype.request=function(e,t,n,r){if(this.options.useOldRequestStyle)return this.oldRequest(e,t,n,r);"function"==typeof t&&(r=t,t="",n=null),"function"==typeof n&&(r=n,n=null),n=n||{};var s=this.initMuxRequestDetails(r,n.max);if(this.publish(e,t,s.inbox),n.timeout){var i=this;s.timeout=setTimeout(function(){s.callback&&s.callback(new l("The request timed out for subscription id: "+s.id,"REQ_TIMEOUT")),i.cancelMuxRequest(s.token)},n.timeout)}return s.id},f.prototype.oldRequest=function(e,t,n,r){"function"==typeof t&&(r=t,t="",n=null),"function"==typeof n&&(r=n,n=null);var s=p(),i=this.subscribe(s,n,function(e,t){r(e,t)});return this.publish(e,t,s),i},f.prototype.requestOne=function(e,t,n,r,s){return this.options.useOldRequestStyle?this.oldRequestOne(e,t,n,r,s):("number"==typeof t&&(s=n,r=t,n=null,t=""),"number"==typeof n&&(s=r,r=n,n=null),(n=n||{}).max=1,n.timeout=r,this.request(e,t,n,s))},f.prototype.extractToken=function(e){return e.substr(this.respmux.inboxPrefixLen)},f.prototype.createResponseMux=function(){if(!this.respmux){var e=this,t=p(),n=t+".*",r=this.subscribe(n,function(t,n,r){var s=e.extractToken(r),i=e.getMuxRequestConfig(s);i&&(i.hasOwnProperty("expected")&&(i.received++,i.received>=i.expected&&e.cancelMuxRequest(s)),i.callback&&i.callback(t,n))});this.respmux={},this.respmux.inbox=t,this.respmux.inboxPrefixLen=t.length+1,this.respmux.subscriptionID=r,this.respmux.requestMap={},this.respmux.nextID=-1}return this.respmux.inbox},f.prototype.initMuxRequestDetails=function(e,t){var n=this.createResponseMux(),r=Et(),s={token:r,callback:e,inbox:n+"."+r,id:this.respmux.nextID--,received:0};return t>0&&(s.expected=t),this.respmux.requestMap[r]=s,s},f.prototype.getMuxRequestConfig=function(e){if("number"==typeof e){var t=null;for(var n in this.respmux.requestMap)if(this.respmux.requestMap.hasOwnProperty(n)){var r=this.respmux.requestMap[n];if(r.id===e){t=r;break}}t&&(e=t.token)}return this.respmux.requestMap[e]},f.prototype.cancelMuxRequest=function(e){var t=this.getMuxRequestConfig(e);return t&&(t.timeout&&clearTimeout(t.timeout),delete this.respmux.requestMap[t.token]),t},f.prototype.oldRequestOne=function(e,t,n,r,s){"number"==typeof t&&(s=n,r=t,n=null,t=""),"number"==typeof n&&(s=r,r=n,n=null),(n=n||{}).max=1;var i=this.request(e,t,n,s);return this.timeout(i,r,1,function(){s(new l("The request timed out for subscription id: "+i,"REQ_TIMEOUT"))}),i},f.prototype.numSubscriptions=function(){return Object.keys(this.subs).length},f.prototype.reconnect=function(){this.closed||(this.reconnects+=1,this.createConnection(),!0===this.currentServer.didConnect&&this.emit("reconnecting"))},f.prototype.scheduleReconnect=function(){var e=this;if(0!==e.servers.length){!0===e.wasConnected&&(e.reconnecting=!0);var t=0;!0===e.servers[0].didConnect&&(t=this.options.reconnectTimeWait),setTimeout(function(){e.reconnect()},t)}}}(Ot={exports:{}},Ot.exports),Ot.exports);Ct.NatsError,Ct.version,Ct.BAD_SUBJECT,Ct.BAD_MSG,Ct.BAD_REPLY,Ct.CONN_CLOSED,Ct.BAD_JSON,Ct.BAD_AUTHENTICATION,Ct.INVALID_ENCODING,Ct.SECURE_CONN_REQ,Ct.NON_SECURE_CONN_REQ,Ct.CLIENT_CERT_REQ,Ct.NATS_PROTOCOL_ERR,Ct.REQ_TIMEOUT,Ct.createInbox,Ct.connect;function xt(e,t){if(xt.installed)return;let n=Ct.connect(t);Object.defineProperty(e.prototype,"$nats",{get:function(){let e=this;return{subscribe:function(){let t=n.subscribe.apply(n,arguments);return e.$on("hook:beforeDestroy",function(){n.unsubscribe(t)}),t},publish:n.publish.bind(n),request:n.request.bind(n),requestOne:n.requestOne.bind(n),unsubscribe:n.unsubscribe.bind(n),flush:n.flush.bind(n),timeout:n.timeout.bind(n),close:n.close.bind(n)}}})}return"undefined"!=typeof window&&window.Vue&&window.Vue.use(xt),xt});
